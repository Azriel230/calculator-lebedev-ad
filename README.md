# calculator-lebedev-ad

## MVP - Калькулятор

### О проекте
Этот проект представляет собой консольное приложение — Калькулятор.
Требования к программе:
- Ввод данных осуществляется через стандартный ввод данных (stdin).
- Вывод осуществляется через стандартный вывод данных (stdout).
- Объем входных данных составляет менее 1 Кбайт (иначе UB).
- Окончание ввода определяется после считывания EOF.
- Разрешена только кодировка [0-9()*+\/\s-] (в противном случае возвращаемый код программы не равен 0).
- 0-9 соответствует одному символу в диапазоне от 0 (индекс 48) до 9 (индекс 57) (с учетом регистра).
- ()\*+ соответствует одному символу в списке ()\*+ (с учетом регистра).
- \/ соответствует символу / с индексом (или) буквально (с учетом регистра) \s соответствует любому символу пробела (эквивалентно [ \r\n\t\f\v ]).
- \- соответствует символу - с индексом (или) буквально (с учетом регистра).
- Допустимы только правильные арифметические выражения (в противном случае возвращаемый код не равен 0).
- Все числа в данном выражении являются целыми числами из диапазона $[0 \dots 2 \times 10^9]$ (в противном случае UB).
- Все промежуточные результаты (для любого допустимого порядка вычисления) укладываются в диапазон $[-2 \times 10^9 \dots +2 \times 10^9]$ (иначе UB).
- Должен поддерживаться флаг --float, который переводит вычисления приложения в режим вещественных чисел, точность которых до 4 знаков после запятой $(10^{-4}).$

### Сборка и запуск программы
Чтобы собрать программу, вам нужен компилятор `gcc` или `clang`. Следуйте этим шагам:
1. Откройте терминал в папке с проектом.
2. Напишите и запустите команду:
```bash
make all
```
Чтобы запустить программу в режиме целых чисел, введите в терминал команду:
```bash
make run-int
```
Чтобы запустить программу в режиме вещественных чисел, введите в терминал команду:
```bash
make run-float
```
### Как это работает?

Для переключения режимов используется глобальный флаг flag_float. 0 — целые числа, 1 — вещественные числа.
Для разделения типов long (целые) и double (дробные) используется объединение Number.
Для вычислений используется структура Stack. В ней содержится массив данных data с достаточно большим размером STACK_SIZE, и переменная top, указывающая на вершину стека.
Для работы со стеком были написаны следующие функции:
- initializeStack — инициализирует стек.
- isEmptyStack и isFullStack — проверяют стек на пустоту и заполненность.
- pushStack — кладет элемент в стек.
- popStack — вытаскивает верхний элемент стека и возвращает его.
- peekStack — возвращает верхний элемент стека, но не удаляет его.
Для проверки корректности требований к программе Калькулятор были написаны функции:
- checkNumberSize — проверяет, что число находится в диапазоне $[-2 \times 10^9 \dots +2 \times 10^9]$.
- validateInput — парсер входного выражения, проверяющий его корректность.
Для вычисления выражения были написаны функции:
- priorityOperations — возвращает номер операции (ее приоритет).
- applyOperation — на вход получает два числа и код операции, а возвращает результат вычисления (исключая деление на 0)
- calculatingExpression — главная функция, которая вычисляет выражение. Создается два стека: для чисел и операций, далее происходит парсинг выражения: числа и операции попадают в стек. Если есть закрывающаяся скобка, то производятся вычисления выражения до тех пор, пока из стека операций не достанем открывающуюся скобку. В конце вычисляется выражение и возвращается его значение.

В функции main считываем флаг --float, выставляем значение флага flag_float, проверяется корректность выражения и производится его вычисление. В конце оно выводится в stdout.

## RC1 - Сервер

Следующий этап развития проекта - сервер, реализованный в **src/server.py** и запускаемый с помощью команды:
```bash
make run-server
```

### Функциональные особенности сервера:
- Запуск в локальной сети (127.0.0.1).
- Сборка калькулятора при запуске сервера.
- Получение POST запроса с выражением для вычисления.
- Запуск калькулятора с полученным выражением.
- Построение отчётов с помощью `structlog`, выведение их в консоль и сохранение в `JSON` формате. 
- Выдаёт код 500 при возникновении ошибок на любом этапе обработки и выполнения запроса.
- Выдаёт код 200 при корректной работе сервера и калькулятора.

### Use case - отправить выражение на вычисление:
- Пользователь отправляет POST-запрос с выражением на сервер.
- Сервер передает выражение калькулятору.
- Калькулятор вычисляет результат или возвращает ошибку.
- Сервер возвращает результат или описание ошибки пользователю.

### Дневники разработки
- 7.03.2025: `GEAR-1`, разработана и протестирована первая версия сервера, обрабатывающая POST запросы и выдающая ответ от калькулятора.
- 8.03.2025: `GEAR-2`, `GEAR-3`, доработан и протестирован функционал логирования, добавлена make-команда для сборки.

## RC2 - GUI

Ипользуем `pyside6`, да помилует нас Господь, для разработки графического интерфейса взаимодействия с сервером.

### Описание и требования к интерфейсу
- Интерфейс содержит: текстовое поле для ввода, checkbox "float", кнопку "Вычислить", текстовое поле для результатов работы.
- Интерфейс программы выстроен с помощью Vertical Layout, где сверху вниз:
  - 1 уровень: текстовое поле для ввода и checkbox "float".
  - 2 уровень: кнопка "Вычислить".
  - 3 уровень: текстовое поле для результатов работы.
- Текстовое поля для ввода изначально пустое. Пользователь может вводить в него знаки [0-9()*+\/-]. Первым символом может быть только цифра или открывающая скобка.
- Checkbox "float" отвечает за наличие флага "--float" в POST-запросе, который отправляется на сервер.
- Кнопка "Вычислить" не активна (не доступна для нажатия) пока текстовое поле для ввода пусто. Кнопка становится активной если в текстовом поле для ввода появляются символы.
- Текстовое поле для результатов работы изначально пустое. Пользователь не может вводить информацию в данное поле. Текстовое поле для результатов работы изменяется при получении результата работы сервера. В нём пишется результат работы калькулятора или описание возникшей ошибки.

### Use cases:
1. Ввод выражения:
   - Пользователь вводит выражение в текстовое поле.
   - Кнопка "Вычислить" становится активной
2. Отправить запрос на сервер:
   - Пользователь нажимает кнопку "Вычислить".
   - Программа отправляет POST-запрос на сервер.
3. Получить результат:
   - Интерфейс получает ответ от сервера и отображает результат или описание ошибки.

### UML-диаграмма данного этапа
![Alt text](/UML.png)